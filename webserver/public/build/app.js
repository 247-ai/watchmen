!function(){"use strict";var e=angular.module("watchmenApp",["ui.router","angularSpinner","ngTable","angularMoment","angularMSTime","watchmenControllers","watchmenFactories","ngResource"]);e.config(function(e,t,r){t.html5Mode(!0),e.state("services",{url:"/services",templateUrl:"service-list.html",controller:"ServiceListCtrl"}).state("viewService",{url:"/services/:id/view",templateUrl:"service-detail.html",controller:"ServiceDetailCtrl"}).state("newService",{url:"/services/add",templateUrl:"service-add.html",controller:"ServiceAddCtrl"}).state("editService",{url:"/services/:id/edit",templateUrl:"service-edit.html",controller:"ServiceEditCtrl"}),r.when("/","/services")})}(),function(){"use strict";angular.module("watchmenFactories",[]);var e=angular.module("watchmenFactories");e.factory("Report",function(e){return e("/api/report/services/:id")}),e.factory("Service",function(e){return e("/api/services/:id")})}(),function(){"use strict";var e=!1;angular.module("watchmenFactories").factory("ngTableUtils",function(t){function r(t,r){var n={page:1,count:r||10,debugMode:!0};return e&&window.localStorage&&window.localStorage.getItem(t)?JSON.parse(window.localStorage.getItem(t)):n}function n(e,n,a,i){return new t(r(e,i),{total:n[e].length,getData:function(t,r){var i=n[e];r.total(i.length);var o=r.sorting()?a("orderBy")(i,r.orderBy()):i,s=o.slice((r.page()-1)*r.count(),r.page()*r.count());t.resolve(s);var l={sorting:r.sorting(),count:r.count(),page:r.page()};window.localStorage&&window.localStorage.setItem(e,JSON.stringify(l))}})}return{createngTableParams:n}})}(),function(){"use strict";window.Charting=window.Charting||{},Charting.generateLatencyChart=function(e){return c3.generate({size:e.size,bindto:e.id,legend:{position:"right"},data:{x:"x",columns:e.columns,types:{Latency:"area-spline",Threshold:"spline"},colors:{Latency:"green",Threshold:"orange"}},axis:{y:{max:isNaN(e.max)?0:e.max,tick:{values:[200,500,1e3,2e3,3e3,4e3,5e3,7e3,1e4,15e3,2e4,3e4]}},x:{type:"timeseries",tick:{format:e.x_format||"%H:%M"}}},tooltip:{format:{title:function(e){return moment(e).format("DD/MMM/YY HH:mm")+" ("+moment(e).fromNow()+")"},value:function(e,t,r){return"Outages"==r?moment.duration(e).humanize():e+" ms."}}}})}}(),function(){"use strict";window.Charting=window.Charting||{};var e=6e4,t=60*e;Charting.generateOutagesChart=function(e){return c3.generate({size:e.size,bindto:e.id,legend:{position:"right"},data:{x:"x",columns:e.columns,types:{Outages:"bar"},colors:{Outages:"red"}},axis:{y:{},x:{min:+new Date-24*t,max:+new Date,type:"timeseries",tick:{format:e.x_format||"%H:%M"}}},tooltip:{format:{title:function(e){return moment(e).format("DD/MMM/YY HH:mm")+" ("+moment(e).fromNow()+")"},value:function(e,t,r){return moment.duration(1e3*e).humanize()}}}})}}(),function(){"use strict";function e(e,t,r){for(var n=[],a=[],i=0;i<e.length;i++)n.push([e[i][t]]),a.push(Math.round([e[i][r]]));return{time:n,data:a}}window.Charting=window.Charting||{};var t=6e4,r=60*t;Charting.renderOutages=function(t){var n=e(t.outages,"timestamp","downtime"),a=n.data.map(function(e){return e/1e3}),i=n.time;return i.splice(0,0,+new Date-24*r),i.push(+new Date),a.splice(0,0,0),a.push(0),i.splice(0,0,"x"),a.splice(0,0,"Outages"),Charting.generateOutagesChart({size:t.size,id:t.id,x_format:t.x_format,columns:[i,a],max:t.max})},Charting.renderLatency=function(t){var r=e(t.latency,"t","l"),n=r.data,a=r.time;a.splice(0,0,"x"),n.splice(0,0,"Latency");var i=n.slice();return i[0]="Threshold",i=i.map(function(e){return isNaN(e)?e:t.threshold}),Charting.generateLatencyChart({size:t.size,id:t.id,x_format:t.x_format,columns:[a,n,i],max:t.max})}}(),angular.module("watchmenControllers",[]),function(){"use strict";var e=angular.module("watchmenControllers");e.controller("ServiceAddCtrl",["$scope","$state","$filter","$stateParams","Service",function(e,t,r,n,a){e.service=new a,e.service.timeout=1e4,e.service.warningThreshold=5e3,e.service.interval=6e4,e.service.failureInterval=3e4,e.service.port=80,e.service.pingServiceName="http-head",e.addService=function(){e.service.$save(function(){t.go("services")},function(t){console.log(t),e.serviceAddErrors=t.data.errors})},e.cancel=function(){t.go("services")}}])}(),function(){"use strict";var e=angular.module("watchmenControllers");e.controller("ServiceDetailCtrl",["$scope","$filter","$stateParams","Report","ngTableUtils","usSpinnerService","$timeout",function(e,t,r,n,a,i,o){i.spin("spinner-1"),e.loading=!0,e.showConfig=!1,e.serviceDetails=n.get({id:r.id},function(t){i.stop("spinner-1"),e.loading=!1,e.latestOutages=t.status.latestOutages;var r=t.status.lastHour.latency,n=t.status.last24Hours.latency,a=t.status.lastWeek.latency,s=_.max(r.list,function(e){return e.l}),l=_.max(n.list,function(e){return e.l}),c=_.max(a.list,function(e){return e.l}),u=_.max([s.l,l.l,c.l]),d=$(".view-frame").width(),m={height:150,width:d};o(function(){t.status.last24Hours.outages.length>0&&Charting.renderOutages({outages:t.status.last24Hours.outages,id:"#chart-outages-last-24hour",size:{height:100,width:d}}),r.list.length>0&&(e.showLastHourChart=!0,Charting.renderLatency({threshold:t.service.warningThreshold,latency:r.list,id:"#chart-last-hour",size:m,max:u})),n.list.length>8&&(e.showLast24Chart=!0,Charting.renderLatency({threshold:t.service.warningThreshold,latency:n.list,id:"#chart-last-24-hours",size:m,max:u})),a.list.length>1&&(e.showLastWeekChart=!0,Charting.renderLatency({threshold:t.service.warningThreshold,latency:a.list,id:"#chart-last-week",size:m,x_format:"%d/%m",max:u}))},0)})}])}(),function(){"use strict";var e,t=3e3,r=angular.module("watchmenControllers");r.controller("ServiceListCtrl",["$scope","$filter","$timeout","Report","Service","usSpinnerService","ngTableUtils",function(r,n,a,i,o,s,l){function c(){a.cancel(e),e=a(function(){d(c,u)},t)}function u(e){r.errorLoadingServices="Error loading data from remote server",console.error(e),c()}function d(e,t){r.services=i.query(function(t){r[m]=t,r.tableParams.reload(),r.errorLoadingServices=null,g.loaded(),e()},t)}var m="tableServicesData";r[m]=[],r.tableParams=l.createngTableParams(m,r,n,25);var g={loading:function(){s.spin("spinner-1"),r.loading=!0},loaded:function(){s.stop("spinner-1"),r.loading=!1}};g.loading(),r["delete"]=function(e){confirm("Are you sure?")&&o["delete"]({id:e},function(){d(function(){},function(){r.errorLoadingServices="Error loading data from remote server"})})},d(c,u)}])}();